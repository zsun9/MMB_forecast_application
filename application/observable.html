<!DOCTYPE html>
<html lang='en'>

  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'>
    <title>Macroeconomic forecasting platform</title>
    <meta name='description' content='Macroeconomic forecasting platform'>
    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css' integrity='sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm' crossorigin='anonymous'>
    <link rel='stylesheet' href='./css/stylesheet.css'>
  </head>

  <body data-spy='scroll' data-target='#navbar-example'>

    <nav id='navbar-example' class='navbar navbar-expand-md navbar-dark bg-dark fixed-top'>
      <a class='navbar-brand' href='index.html'>Online Forecasting Platform</a>
      <button class='navbar-toggler' type='button' data-toggle='collapse' data-target='#navbarsExampleDefault' aria-controls='navbarsExampleDefault' aria-expanded='false' aria-label='Toggle navigation'>
      <span class='navbar-toggler-icon'></span>
      </button>
  
      <div class='collapse navbar-collapse' id='navbarsExampleDefault'>
      <ul class='navbar-nav mr-auto'>
        <li class='nav-item'>
          <a class='nav-link' href='./index.html'>Home</a>
        </li>
        <li class='nav-item'>
          <a class='nav-link' href='./forecast.html'>Forecast</a>
        </li>
        <li class='nav-item'>
          <a class='nav-link' href='./rmse.html'>RMSE</a>
        </li>
        <li class='nav-item'>
          <a class='nav-link' href='./observable.html'>Observables</a>
        </li>
        <li class='nav-item'>
          <a class='nav-link' href='./about.html'>About</a>
        </li>
      </ul>
      </div>
    </nav>

    <div class='container'>
      <h1 class='page-header'>Observed variables</h1>
      <p class='lead'>To plot observed variables, choose their names along with their vintage dates and data scenarios</p>
    </div>

    <div class='container'>
      <form id='selectForm'>
        <div class='row justify-content-center'>
          <button type='submit' class='btn btn-primary'>Submit</button>
        </div>
      </form>
    </div>

    <hr>

    <div class='container-fluid'>
      <div class='row'>
        <div class='col'>
          <canvas id='observedChart'>
          </canvas>
        </div>
      </div>
    </div>

    <script src='https://code.jquery.com/jquery-3.5.1.js' integrity='sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=' crossorigin='anonymous'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js' integrity='sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q' crossorigin='anonymous'></script>
    <script src='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js' integrity='sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl' crossorigin='anonymous'></script>

    <script src="../node_modules/chart.js/dist/Chart.bundle.js"></script>
    <script src="../node_modules/chartjs-plugin-annotation/chartjs-plugin-annotation.js"></script>

    <script>
      'use strict';

      const colorSet = ['red', 'blue', 'green', 'cyan'];

      let input = [
        // {variable: 'baag10_obs', vintage: '2020-05-12', scenario: 's3'},
        // {variable: 'bbb1yffr_obs', vintage: '2008-08-07', scenario: 's3'},
        {variable: 'gdp_rgd_obs', vintage: '2008-11-10', scenario: 's3'},
        {variable: 'gdp_rgd_obs', vintage: '2020-05-12', scenario: 's3'},
        // {variable: 'blt_obs', vintage: '2001-02-14', scenario: 's1'},
      ];

      const scenarioLabels = {
        's2': ', with SPF nowcast value (if available)',
        's3': ', with current-quarter value (if available)',
      };

      document.getElementById('selectForm').addEventListener('submit', function (event) {
        event.preventDefault();

        fetch('observed.json').then(response => response.json()).then(data => {
          
          let datasets = [];
          let biggestNum = -999, smallestNum = 999;
          var colorOrder = -1;
          for (let item of input) {
            var observedData = [];
            for (let i = 0; i < data.length; i++) {
              if ((data[i].variable == item.variable) && (data[i].vintage == item.vintage) && (data[i].scenario == item.scenario)) {
                observedData = data[i].value;
                colorOrder += 1;
                break;
              }
            }

            let xlabels = new Array(observedData.length);

            let yearStart = parseInt(item.vintage.substring(0, 4));
            let quarterStart = Math.floor((parseInt(item.vintage.substring(5,7)) - 1) / 3) + 1;
            let currentNumber = (yearStart - 2000)*4 + (quarterStart - 1);
            for (let i = xlabels.length - 1; i > -1; i--) {
              xlabels[i] = currentNumber;
              observedData[i] = {x: currentNumber, y: observedData[i]};
              biggestNum = Math.max(biggestNum, currentNumber);
              smallestNum = Math.min(smallestNum, currentNumber);
              currentNumber -= 1;
              
            }
            // let vintageQuarterTemp = item.vintage.substring(0, 4) + 'Q' + Math.floor((parseInt(item.vintage.substring(5,7)) - 1) / 3 + 1);
            // for (let i = xlabels.length - 1; i > -1; i--) {
            //   xlabels[i] = vintageQuarterTemp.substring(2,);
            //   if (vintageQuarterTemp[5] == '1') {
            //     vintageQuarterTemp = (parseInt(vintageQuarterTemp.substring(0, 4)) - 1) + 'Q4';
            //   } else {
            //     vintageQuarterTemp = vintageQuarterTemp.substring(0, 5) + (parseInt(vintageQuarterTemp[5]) - 1);
            //   }
            // }


            datasets.push({
              fill: false,
              label: item.variable + ', ' + item.vintage + ', ' + scenarioLabels[item.scenario],
              data: observedData,
              backgroundColor: colorSet[colorOrder],
              borderColor: colorSet[colorOrder],
              // labels: xlabels,
              showLine: true,
            })
          }

          let xlabels = [];
          for (let i = smallestNum; i <= biggestNum; i++) {
            xlabels.push(i);
          }

          let ctx = document.getElementById('observedChart').getContext('2d');
        
          Chart.defaults.global.defaultFontFamily = 'Source Sans Pro';
          Chart.defaults.global.defaultFontSize = 16;
          Chart.defaults.global.elements.point.radius = 1.5;
          Chart.defaults.global.elements.line.tension = 0;
          let chart = new Chart(ctx, {
            type: 'scatter',

            data: {
              labels: xlabels,
              datasets: datasets,
            },

            options: {
            }
          })

        })



      })
      
    </script>

    

  </body>

</html>